---
import { Image } from "astro:assets";
import { render } from "astro:content";
import BaseLayout from "./BaseLayout.astro";

interface Props {
    title: string;
    picture: any;
    prevPicture?: any;
    nextPicture?: any;
    pictureNumber?: number;
    totalPictures?: number;
}

const {
    title,
    picture,
    prevPicture,
    nextPicture,
    pictureNumber,
    totalPictures,
} = Astro.props;

// Render the picture content to get the description text
const { Content } = await render(picture);
---

<BaseLayout title={title}>
    <!-- Main content container with heritage styling -->
    <div class="max-w-4xl mx-auto bg-white border border-gray-300 p-4 mb-4">
        <!-- Top Navigation -->
        <div class="text-center mb-6 pb-3 border-b border-gray-300">
            <div class="heritage-links text-xs">
                {
                    prevPicture && (
                        <a
                            href={`/pictures/${picture.data.gallery}/${prevPicture.id.split("/").pop()?.replace(".md", "")}/`}
                            class="text-teal-600 hover:text-green-600"
                        >
                            « prev
                        </a>
                    )
                }
                {
                    prevPicture && pictureNumber && totalPictures && (
                        <span class="text-gray-500"> | </span>
                    )
                }
                {
                    pictureNumber && totalPictures && (
                        <span class="text-gray-700">
                            {pictureNumber} of {totalPictures}
                        </span>
                    )
                }
                {
                    pictureNumber && totalPictures && nextPicture && (
                        <span class="text-gray-500"> | </span>
                    )
                }
                {
                    nextPicture && (
                        <a
                            href={`/pictures/${picture.data.gallery}/${nextPicture.id.split("/").pop()?.replace(".md", "")}/`}
                            class="text-teal-600 hover:text-green-600"
                        >
                            next »
                        </a>
                    )
                }
            </div>
        </div>

        <!-- Main Picture Display -->

        <!-- Picture Title and Description -->
        <div class="mb-6">
            <h1 class="text-sm text-gray-800">
                <a
                    href={`/pictures/${picture.data.gallery}/`}
                    class="heritage-links text-green-200 hover:text-green-600"
                >
                    {
                        picture.data.gallery.charAt(0).toUpperCase() +
                            picture.data.gallery.slice(1)
                    }:
                </a>
                {picture.data.title}
            </h1>

            <div class="text-xs text-gray-700 picture-description">
                <Content />
            </div>
        </div>

        <!-- Picture Metadata -->
        <div class="heritage-links text-xs text-gray-600 mb-6">
            {
                picture.data.date && (
                    <span>
                        Posted on{" "}
                        {picture.data.date.toLocaleDateString("en-US", {
                            year: "numeric",
                            month: "long",
                            day: "numeric",
                        })}{" "}
                        in
                    </span>
                )
            }
            {
                picture.data.gallery && (
                    <>
                        <span> </span>
                        <strong>
                            <a
                                href={`/pictures/${picture.data.gallery}/`}
                                class="text-teal-600 hover:text-green-600"
                            >
                                {picture.data.gallery.charAt(0).toUpperCase() +
                                    picture.data.gallery.slice(1)}
                            </a>
                        </strong>
                    </>
                )
            }
            {
                picture.data.photographer && (
                    <>
                        <span> by </span>
                        <span>{picture.data.photographer}</span>
                    </>
                )
            }
        </div>

        <!-- Bottom Navigation -->
        <div class="text-center text-xs mb-4">
            <p class="mb-3 text-gray-700">
                You are looking at picture {pictureNumber} of {totalPictures} in
                the {picture.data.gallery} picture gallery. For more, follow the
                links below.
            </p>
            <div class="heritage-links">
                {
                    prevPicture && (
                        <a
                            href={`/pictures/${picture.data.gallery}/${prevPicture.id.split("/").pop()?.replace(".md", "")}/`}
                            class="text-teal-600 hover:text-green-600"
                        >
                            « prev
                        </a>
                    )
                }
                {
                    prevPicture && nextPicture && (
                        <span class="text-gray-500"> | </span>
                    )
                }
                {
                    nextPicture && (
                        <a
                            href={`/pictures/${picture.data.gallery}/${nextPicture.id.split("/").pop()?.replace(".md", "")}/`}
                            class="text-teal-600 hover:text-green-600"
                        >
                            next »
                        </a>
                    )
                }
                <span class="text-gray-500"> | </span>
                <a
                    href={`/pictures/${picture.data.gallery}/`}
                    class="text-teal-600 hover:text-green-600"
                >
                    This Trip
                </a>
                <span class="text-gray-500"> | </span>
                <a href="/pictures/" class="text-teal-600 hover:text-green-600">
                    Picture Gallery
                </a>
                <span class="text-gray-500"> | </span>
                <a href="/" class="text-teal-600 hover:text-green-600">
                    Home
                </a>
            </div>
        </div>

        <!-- Copyright -->
        <div
            class="text-xs text-gray-600 text-center border-t border-gray-300 pt-3"
        >
            Copyright © Offroaders Club Karachi.
            <a href="/about/" class="text-teal-600 hover:text-green-600"
                >Some Rights Reserved</a
            >.
        </div>
    </div>
</BaseLayout>

<style>
    /* Hide image elements from rendered markdown content to prevent duplication */
    .picture-description img {
        display: none;
    }

    /* Style for heritage images */
    .heritage-image {
        padding: 4px;
        border: 1px solid #ccc;
        background: #f8f8ff;
    }

    /* Heritage link colors */
    .heritage-links a:link {
        color: #00473f;
        text-decoration: none;
    }
    .heritage-links a:visited {
        color: #cc9966;
    }
    .heritage-links a:hover {
        color: #00473f;
        text-decoration: underline;
    }

    /* Comments styling inspired by original pics.css */
    #comments {
        margin-top: 24px;
        padding-top: 16px;
        border-top: 1px solid #ddd;
    }

    #comment {
        padding: 8px;
        margin: 0 0 12px 0;
        border: 1px solid #ccc;
        background: #e3e3f8;
        font-size: 11px;
        line-height: 1.5;
    }

    #comment:hover {
        background: #eef;
        border-color: #dadaba;
    }

    #comment strong {
        color: #00473f;
        font-weight: bold;
    }

    #comment p {
        margin: 4px 0;
        font-size: 11px;
    }
</style>
