---
import { getCollection } from 'astro:content';
import PageLayout from '../../layouts/PageLayout.astro';

// Get all published posts
const posts = await getCollection('posts', ({ data }) => !data.draft);
const sortedPosts = posts.sort((a, b) =>
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
---

<PageLayout
  title="Blog Posts - OffroadPakistan"
  description="Pakistani adventure and travel stories from the 4x4 Offroaders Club Karachi"
>
  <!-- Page Header -->
  <header class="mb-8">
    <h1 class="text-sm md:text-base font-bold text-gray-600 mb-2">Blog Posts</h1>
    <p class="text-xs md:text-sm text-gray-700 mb-4 leading-relaxed">
      Stories and adventures from the 4x4 Offroaders Club Karachi members.
      These chronicles document decades of Pakistani adventure travel.
    </p>
    <p class="text-xs text-gray-600">
      {posts.length} posts documenting journeys across Pakistan.
    </p>
  </header>

  <!-- Posts List -->
  <div class="space-y-6">
    {sortedPosts.map((post) => (
      <article class="border-b border-gray-300 pb-4 mb-4 last:border-b-0">
        <!-- Post Title -->
        <h2 class="text-sm md:text-base font-bold mb-2">
            <a href={`/posts/${post.id}/`} class="text-[#00473F] hover:text-[#CC3300] transition-colors">
                {post.data.title}
                {post.data.featured && (
                  <span class="ml-1 inline-block w-2 h-2 bg-green-500 rounded-full" title="Featured post"></span>
                )}
            </a>
        </h2>

        <!-- Post Meta -->
        <div class="flex flex-wrap items-center gap-2 md:gap-4 text-xs text-gray-600 mb-2">
          <time datetime={post.data.date.toISOString()}>
            {post.data.date.toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'short',
              day: 'numeric'
            })}
          </time>
          {post.data.author && (
            <>
              <span class="text-gray-400 hidden md:inline">|</span>
              <span>By {post.data.author}</span>
            </>
          )}
          {post.data.category && (
            <>
              <span class="text-gray-400 hidden md:inline">|</span>
              <span>
                <a
                  href={`/posts/category/${post.data.category}/`}
                  class="text-teal-600 hover:underline"
                >
                  {post.data.category}
                </a>
              </span>
            </>
          )}
        </div>

        <!-- Excerpt if available -->
        {post.data.excerpt && (
          <p class="text-xs md:text-sm text-gray-700 mb-3 leading-relaxed">
            {post.data.excerpt}
          </p>
        )}

        <!-- Tags -->
        {post.data.tags && post.data.tags.length > 0 && (
          <div class="text-xs text-gray-500 mb-3">
            <span class="text-gray-600">Tags: </span>
            {post.data.tags.map((tag: string, index: number) => (
              <span>
                <a
                  href={`/posts/tag/${tag}/`}
                  class="text-green-600 hover:underline"
                >
                  {tag}
                </a>
                {index < (post.data.tags?.length || 0) - 1 && <span class="text-gray-400">, </span>}
              </span>
            ))}
          </div>
        )}

        <!-- Read More Link -->
        <div class="text-xs">
            <a
                href={`/posts/${post.id}/`}
                class="text-[#00473F] hover:text-[#CC3300] font-bold transition-colors"
            >
                Read More â†’
            </a>
        </div>
      </article>
    ))}
  </div>

  {sortedPosts.length === 0 && (
    <div class="text-center py-8">
      <p class="text-sm text-gray-600">No posts available at the moment.</p>
    </div>
  )}

  <!-- Heritage Note -->
  <div class="mt-8 p-4 bg-gray-50 border border-gray-200 text-xs md:text-sm">
    <h3 class="font-bold text-teal-600 mb-2">Heritage Archive</h3>
    <p class="text-gray-700 leading-relaxed">
      These blog posts represent decades of Pakistani adventure documentation by the 4x4 Offroaders Club Karachi.
      Originally published at offroadpakistan.com from 2003-2008, these stories capture the spirit of exploration
      and the raw beauty of Pakistan's diverse landscapes.
    </p>
  </div>
</PageLayout>
